(function(){function P(){t.add(e);t.fog=new THREE.Fog(0,1800,3e3);n.setSize(w,E);document.body.appendChild(n.domElement);window.addEventListener("resize",H,!1);k[0]=new U("GOLD",13812354,40,0,0,0);k[1]=new U("GREEN",65280,44,0,0,0);k[2]=new U("RED",16711680,36,0,0,0);k[3]=new U("BLUE",255,50,0,0,0);console.log(UserMaxConnection[0].max,UserMaxConnection[1].max,UserMaxConnection[2].max,UserMaxConnection[3].max);L[0]=new z(k[0],k[1]);L[1]=new z(k[0],k[2]);L[2]=new z(k[0],k[3]);L[3]=new z(k[1],k[2]);L[4]=new z(k[1],k[3]);L[5]=new z(k[2],k[3]);A[0]=new R(0,0,0);A[1]=new R(200,60,0);A[2]=new R(-70,300,0);A[3]=new R(-320,-350,0);X();B()}function H(){e.aspect=window.innerWidth/window.innerHeight;e.updateProjectionMatrix();n.setSize(window.innerWidth,window.innerHeight)}function B(){renderPass=new THREE.RenderPass(t,e);copyPass=new THREE.ShaderPass(THREE.CopyShader);vignettePass=new THREE.ShaderPass(THREE.VignetteShader);vignettePass.uniforms.darkness.value=1.5;composer=new THREE.EffectComposer(n);composer.addPass(renderPass);composer.addPass(vignettePass);composer.addPass(copyPass);copyPass.renderToScreen=!0}function F(){var e=new THREE.PointLight(16777215);e.position.x=10;e.position.y=50;e.position.z=130;t.add(e);t.add(new THREE.AmbientLight(16750848));var n=new THREE.DirectionalLight(16777215,.55,500);t.add(n);var r=new THREE.DirectionalLight(16777215,.25,500);r.position.set(0,0,1).normalize();t.add(r)}function I(){plane=new THREE.Mesh(new THREE.PlaneGeometry(3e3,3e3,20,20),new THREE.MeshBasicMaterial({ambient:197379,color:13421772,shading:THREE.FlatShading,opacity:.2,transparent:!0,wireframe:!1,blending:THREE.AdditiveBlending}));plane.rotation.x=-Math.PI/2;plane.position.y=-50;t.add(plane);for(var e=0;e<441;e++){var n=Math.floor(Math.random()*400-600);plane.geometry.vertices[e].z=n}}function q(){var e="Phil",n=document.location.hash.substr(1);n.length!==0&&(e=n);var r=new THREE.TextGeometry(e,{size:30,height:20,curveSegments:2,font:"helvetiker"});r.computeBoundingBox();var i=-0.5*(r.boundingBox.max.x-r.boundingBox.min.x),s=new THREE.MeshBasicMaterial({color:16777215,overdraw:!0,shading:THREE.FlatShading});_=new THREE.Mesh(r,s);_.position.x=Math.cos(i);_.position.y=60;_.position.z=Math.sin(i);D=new THREE.Object3D;D.add(_);t.add(D)}function R(e,t,n){this.x=e;this.y=t;this.z=n}function U(e,n,r,i,s,o){this.sId=e;this.sColor=n;this.sRadius=r;var u=new THREE.MeshLambertMaterial({ambient:16777215,color:n,specular:0,shininess:0,shading:THREE.FlatShading,opacity:1,transparent:!0}),a=new THREE.SphereGeometry(r,16,16);this.sphere=new THREE.Mesh(a,u);this.sphere.position.x=i;this.sphere.position.y=s;this.sphere.position.z=o;t.add(this.sphere)}function z(e,n){this.sphereA=e;this.sphereB=n;var r=new THREE.Vector3(e.sphere.position.x,e.sphere.position.y,e.sphere.position.z),i=new THREE.Vector3(n.sphere.position.x,n.sphere.position.y,n.sphere.position.z),s=new THREE.Geometry;s.vertices.push(r);s.vertices.push(i);s.verticesNeedUpdate=!0;var o=new THREE.LineBasicMaterial({color:16750848,opacity:.5,linewidth:5});this.line=new THREE.Line(s,o);this.line.geometry.verticesNeedUpdate=!0;t.add(this.line)}function W(){for(var e=0;e<k.length;e++){var n=k[e].sId,r=k[e].sColor,i=Math.floor(Math.random()*2),s;i==0?s=UserMaxConnection[e].max+3:s=UserMaxConnection[e].max-3;console.log(UserMaxConnection[0].max,UserMaxConnection[1].max,UserMaxConnection[2].max,UserMaxConnection[3].max);var o=k[e].sphere.position.x,u=k[e].sphere.position.y,a=k[e].sphere.position.z;t.remove(k[e].sphere);k[e]=new U(n,r,s,o,u,a)}t.remove(L[0].line);t.remove(L[1].line);t.remove(L[2].line);t.remove(L[3].line);t.remove(L[4].line);t.remove(L[5].line);L[0]=new z(k[0],k[1]);L[1]=new z(k[0],k[2]);L[2]=new z(k[0],k[3]);L[3]=new z(k[1],k[2]);L[4]=new z(k[1],k[3]);L[5]=new z(k[2],k[3])}function X(){for(var e=0;e<k.length;e++){k[e].sphere.position.x=A[e].x;k[e].sphere.position.y=A[e].y;k[e].sphere.position.z=A[e].z}}function V(){var e=new Array;for(var t=0;t<k.length;t++){var n=0;for(var r=0;r<k.length;r++)k[r].sRadius>k[t].sRadius?n++:k[r].sRadius==k[t].sRadius&&r>t&&n++;e[t]=n}for(var t=0;t<k.length;t++){var i=e[t],s=k[t],o=s.sphere.position.x,u=s.sphere.position.y,a=s.sphere.position.z,f=A[i].x,l=A[i].y,c=A[i].z;J(s,o,u,a,f,l,c)}}function J(e,t,n,r,i,s,o){var u=function(){e.sphere.position.x=a.x;e.sphere.position.y=a.y;e.sphere.position.z=a.z},a={x:t,y:n,z:r},f=TWEEN.Easing.Quintic.EaseInOut,l=(new TWEEN.Tween(a)).to({x:i,y:s,z:o},O).delay(M).easing(f).onUpdate(u).start()}function K(){for(var e=0;e<L.length;e++){var t=L[e].sphereA.sphere.position,n=L[e].sphereB.sphere.position;L[e].line.geometry.vertices[0].set(t.x,t.y,t.z);L[e].line.geometry.vertices[1].set(n.x,n.y,n.z);L[e].line.geometry.verticesNeedUpdate=!0}}function Q(){TWEEN.removeAll();W();V();okayToUpdate=!1;G()}function G(){setTimeout(function(){okayToUpdate=!0},2e3)}function Y(r){var i=Date.now()*2e-4;if(C){e.position.x=Math.cos(i)*1500;e.position.z=Math.sin(i)*1500}K();e.lookAt(t.position);n.render(t,e);requestAnimationFrame(Y);TWEEN.update();composer.render(.1)}var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m=!0;mouseX=0,mouseY=0,okayToUpdate=!0,UserMaxConnection=[{id:0,max:0},{id:1,max:0},{id:2,max:0},{id:3,max:0}],relationshipsDbInsert=[{conId:1,relationship:0},{conId:2,relationship:0},{conId:3,relationship:0},{conId:4,relationship:0},{conId:5,relationship:0},{conId:6,relationship:0}],allViewArray=[],allViewArrayRel=[],useLiveData=!0,useAllData=!1,intervalTimerId=0,intervalTimerIdRelationship=0;$("#usersWindow").click(function(){$("#usersWindow").toggleClass("userWindowActive")});$("#relationshipWindow").click(function(){$("#relationshipWindow").toggleClass("relationshipWindowActive")});$("#all-view").click(function(){useLiveData=!1;useAllData=!0;b.emit("all-view-request");console.log("All view has been selected and socket request sent to server");$("#all-view").addClass("view-button-active");$("#live-view").removeClass("view-button-active");$("#more-view").removeClass("view-button-active")});$("#live-view").click(function(){useLiveData=!0;useAllData=!1;$("#live-view").addClass("view-button-active");$("#all-view").removeClass("view-button-active");$("#more-view").removeClass("view-button-active");clearInterval(intervalTimerId);clearInterval(intervalTimerIdRelationship)});$("#circle-buzz").click(function(){console.log("Circle buzz Click");b.emit("circlebuzz",1)});$("#front-back-buzz").click(function(){console.log("FB Buzz Click");b.emit("fbbuzz",1)});$("#all-buzz").click(function(){console.log("ALL Buzz Click");b.emit("allbuzz",1)});var g="",y={};maxConnection={};var b=io.connect("http://141.163.233.7");b.on("relationshipConnections",function(e){y=e;if(useLiveData===!0)for(var t=1;t<7;t++)if(y.conId===t){j=t-1;relationshipsDbInsert[j].conId=y.conId;relationshipsDbInsert[j].relationship=y.relationship;$("#rel"+t).html("Relationship ID "+t+"'s connection is "+y.relationship)}});b.on("maxConnection",function(e){maxConnection=e;if(useLiveData===!0)for(var t=0;t<4;t++)if(maxConnection.id===t){UserMaxConnection[t].id=maxConnection.id;UserMaxConnection[t].max=maxConnection.max;okayToUpdate===!0&&Q();$("#user"+t).html("Max Connection for ID "+t+" = "+maxConnection.max)}});b.on("all-view-data-user",function(e){allViewArray=JSON.parse(e);if(useAllData===!0){var t=0;function n(){console.log(allViewArray[t]);t=(t+1)%allViewArray.length;for(var e=0;e<4;e++)if(allViewArray[t].id===e){UserMaxConnection[e].id=allViewArray[t].id;UserMaxConnection[e].max=allViewArray[t].max;okayToUpdate===!0&&Q()}}n();intervalTimerId&&clearInterval();intervalTimerId=setInterval(n,2500)}});b.on("all-view-data-relationship",function(e){allViewArrayRel=JSON.parse(e);if(useAllData===!0){var t=0;function n(){console.log(allViewArrayRel[t]);t=(t+1)%allViewArrayRel.length;for(var e=0;e<4;e++)if(allViewArrayRel[t].id===e){relationshipsDbInsert[e].conId=allViewArrayRel[t].conId;relationshipsDbInsert[e].relationship=allViewArrayRel[t].relationship;okayToUpdate===!0&&Q()}}n();intervalTimerIdRelationship&&clearInterval(intervalTimerIdRelationship);intervalTimerIdRelationship=setInterval(n,2300)}});b.on("testingTopic",function(e){$("#latestInput").html(e)});setTimeout(function(){console.log(UserMaxConnection[0].max,UserMaxConnection[1].max,UserMaxConnection[2].max,UserMaxConnection[3].max)},1e3);var w=window.innerWidth,E=window.innerHeight,S=45,x=w/E,T=.1,N=1e4,n=new THREE.WebGLRenderer,e=new THREE.PerspectiveCamera(S,x,T,N);e.position.set(0,600,0);var C=!0,t=new THREE.Scene,k=new Array,L=new Array,A=new Array,O=2500,M=0,_,D;setTimeout(function(){P();F();I();Y()},5e3)})();